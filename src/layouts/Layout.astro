---
import '../styles/global.css';

export interface Props {
  title: string;
  description?: string;
}

const { title, description = "ServirPRO: Tu tranquilidad asegurada" } = Astro.props;
---

<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content={description} />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <title>{title}</title>
    
    <!-- Google Fonts - Montserrat -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    
    <!-- Iconify Script -->
    <script src="https://code.iconify.design/iconify-icon/2.1.0/iconify-icon.min.js"></script>
    
    <style is:global>
      .icon {
        display: inline-block;
        width: 1em;
        height: 1em;
        vertical-align: middle;
        fill: none;
        stroke: currentColor;
        stroke-width: 2;
        stroke-linecap: round;
        stroke-linejoin: round;
      }

      /* Estilos para simular la imagen de fondo */
      .hero-background {
        /* Usamos una imagen de placeholder que simula un encuentro de negocios */
        background-image: url('https://placehold.co/1920x800/224050/ffffff?text=Reunión+de+negocios+ServirPRO');
        background-size: cover;
        background-position: center;
      }

      /* Estilos para el difuminado azul */
  

      /* Estilos mejorados para los menús desplegables */
      .dropdown-group {
        position: relative;
      }

      /* Área extendida de hover para mejor UX */
      .dropdown-group::before {
        content: '';
        position: absolute;
        top: 0;
        left: -10px;
        right: -10px;
        bottom: -10px;
        z-index: 1;
      }

      .dropdown-menu {
        position: absolute;
        left: 0;
        top: 100%;
        margin-top: 0.25rem;
        width: 12rem;
        border-radius: 0.375rem;
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        background-color: white;
        border: 1px solid rgba(0, 0, 0, 0.05);
        opacity: 0;
        visibility: hidden;
        transform: translateY(-10px);
        transition: all 0.3s ease-out;
        z-index: 50;
        pointer-events: none;
        padding-top: 0.25rem;
      }

      /* Hover states para mostrar dropdown */
      .dropdown-group:hover .dropdown-menu,
      .dropdown-menu:hover {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
        pointer-events: auto;
      }

      /* Mantener dropdown abierto cuando se hace hover sobre el menú */
      .dropdown-group:hover .dropdown-menu:hover {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
        pointer-events: auto;
      }

      .dropdown-arrow {
        transition: transform 0.3s ease-out;
      }

      .dropdown-group:hover .dropdown-arrow {
        transform: rotate(180deg);
      }

      /* Estilos para los indicadores del carrusel */
      .carousel-indicator.active {
        background-color: white;
      }
    </style>
  </head>
  <body class="font-sans antialiased bg-gray-50">
    <slot />
    
    <!-- Script para la interactividad del menú responsive -->
    <script>
      // Variables globales
      let currentSlide = 0;
      let currentOfficeSlide = 0;
      let currentReviewSlide = 0;
      const totalSlides = 3;
      const totalOfficeSlides = 4;
      const totalReviewSlides = 4;

      // Función para mostrar slide específico
      function showSlide(slideIndex) {
        const slides = document.querySelectorAll('.carousel-slide');
        const indicators = document.querySelectorAll('.carousel-indicator');
        
        // Ocultar todos los slides
        slides.forEach(slide => slide.classList.add('hidden'));
        indicators.forEach(indicator => indicator.classList.remove('active'));
        
        // Mostrar slide actual
        if (slides[slideIndex]) {
          slides[slideIndex].classList.remove('hidden');
        }
        if (indicators[slideIndex]) {
          indicators[slideIndex].classList.add('active');
        }
        
        currentSlide = slideIndex;
      }

      // Función para ir al siguiente slide
      function nextSlide() {
        currentSlide = (currentSlide + 1) % totalSlides;
        showSlide(currentSlide);
      }

      // Función para ir al slide anterior
      function prevSlide() {
        currentSlide = (currentSlide - 1 + totalSlides) % totalSlides;
        showSlide(currentSlide);
      }

      // Función para mostrar slide de oficina específico
      function showOfficeSlide(slideIndex) {
        const slides = document.querySelectorAll('.office-slide');
        
        // Ocultar todos los slides
        slides.forEach(slide => slide.classList.add('hidden'));
        
        // Mostrar slide actual
        if (slides[slideIndex]) {
          slides[slideIndex].classList.remove('hidden');
        }
        
        currentOfficeSlide = slideIndex;
      }

      // Función para ir al siguiente slide de oficina
      function nextOfficeSlide() {
        currentOfficeSlide = (currentOfficeSlide + 1) % totalOfficeSlides;
        showOfficeSlide(currentOfficeSlide);
      }

      // Función para ir al slide anterior de oficina
      function prevOfficeSlide() {
        currentOfficeSlide = (currentOfficeSlide - 1 + totalOfficeSlides) % totalOfficeSlides;
        showOfficeSlide(currentOfficeSlide);
      }

      // Función para mostrar slide de reseña específico
      function showReviewSlide(slideIndex) {
        const slides = document.querySelectorAll('.review-slide');
        
        // Ocultar todos los slides
        slides.forEach(slide => slide.classList.add('hidden'));
        
        // Mostrar slide actual
        if (slides[slideIndex]) {
          slides[slideIndex].classList.remove('hidden');
        }
        
        currentReviewSlide = slideIndex;
      }

      // Función para ir al siguiente slide de reseña
      function nextReviewSlide() {
        currentReviewSlide = (currentReviewSlide + 1) % totalReviewSlides;
        showReviewSlide(currentReviewSlide);
      }

      // Función para ir al slide anterior de reseña
      function prevReviewSlide() {
        currentReviewSlide = (currentReviewSlide - 1 + totalReviewSlides) % totalReviewSlides;
        showReviewSlide(currentReviewSlide);
      }

      // Control del Sidemenu móvil con overlay
      function openMobileMenu() {
        const overlay = document.getElementById('mobile-overlay');
        const panel = document.getElementById('mobile-menu-panel');
        if (!overlay || !panel) return;
        overlay.classList.remove('hidden');
        // Iniciar fade-in del overlay
        requestAnimationFrame(() => {
          overlay.classList.remove('opacity-0');
          overlay.classList.add('opacity-100');
        });
        // Expandir panel desde la izquierda
        panel.classList.remove('scale-x-0');
        panel.classList.add('scale-x-100');
        document.body.style.overflow = 'hidden';
      }

      function closeMobileMenu() {
        const overlay = document.getElementById('mobile-overlay');
        const panel = document.getElementById('mobile-menu-panel');
        if (!overlay || !panel) return;
        // Contraer panel hacia la izquierda
        panel.classList.remove('scale-x-100');
        panel.classList.add('scale-x-0');
        // Iniciar fade-out del overlay y esperar la transición antes de ocultarlo
        overlay.classList.remove('opacity-100');
        overlay.classList.add('opacity-0');
        setTimeout(() => {
          overlay.classList.add('hidden');
          document.body.style.overflow = '';
        }, 300);
      }

      function toggleMobileMenu() {
        const overlay = document.getElementById('mobile-overlay');
        if (!overlay) return;
        if (overlay.classList.contains('hidden')) {
          openMobileMenu();
        } else {
          closeMobileMenu();
        }
      }

      // Funciones para dropdowns del header
      function toggleDropdown(dropdownName) {
        const dropdown = document.querySelector(`[data-dropdown="${dropdownName}"] .dropdown-menu`);
        const arrow = document.querySelector(`[data-dropdown="${dropdownName}"] .dropdown-arrow`);
        
        // Cerrar todos los otros dropdowns
        document.querySelectorAll('.dropdown-menu').forEach(menu => {
          if (menu !== dropdown) {
            menu.classList.add('opacity-0', 'invisible');
            menu.classList.remove('opacity-100', 'visible');
          }
        });
        
        document.querySelectorAll('.dropdown-arrow').forEach(arr => {
          if (arr !== arrow) {
            arr.style.transform = 'rotate(0deg)';
          }
        });
        
        // Toggle del dropdown actual
        if (dropdown.classList.contains('opacity-0')) {
          dropdown.classList.remove('opacity-0', 'invisible');
          dropdown.classList.add('opacity-100', 'visible');
          arrow.style.transform = 'rotate(180deg)';
        } else {
          dropdown.classList.add('opacity-0', 'invisible');
          dropdown.classList.remove('opacity-100', 'visible');
          arrow.style.transform = 'rotate(0deg)';
        }
      }

      // Función para toggle de acordeones móviles específicos
      function toggleMobileAccordion(section) {
        const content = document.getElementById(`mobile-${section}-content`);
        const icon = document.getElementById(`mobile-${section}-icon`);
        
        if (content.classList.contains('hidden')) {
          content.classList.remove('hidden');
          icon.style.transform = 'rotate(180deg)';
        } else {
          content.classList.add('hidden');
          icon.style.transform = 'rotate(0deg)';
        }
      }

      // Toggle de acordeones móviles
      function toggleAccordion(accordionId) {
        const accordion = document.getElementById(accordionId);
        const arrow = accordion.previousElementSibling.querySelector('.accordion-arrow');
        
        if (accordion.classList.contains('hidden')) {
          accordion.classList.remove('hidden');
          arrow.style.transform = 'rotate(180deg)';
        } else {
          accordion.classList.add('hidden');
          arrow.style.transform = 'rotate(0deg)';
        }
      }

      // Toggle del campo de búsqueda móvil
      function toggleSearch() {
        const searchField = document.getElementById('mobile-search-field');
        const searchIcon = document.getElementById('search-icon');
        const closeSearchIcon = document.getElementById('close-search-icon');
        
        if (searchField.classList.contains('hidden')) {
          searchField.classList.remove('hidden');
          searchIcon.classList.add('hidden');
          closeSearchIcon.classList.remove('hidden');
          searchField.querySelector('input').focus();
        } else {
          searchField.classList.add('hidden');
          searchIcon.classList.remove('hidden');
          closeSearchIcon.classList.add('hidden');
        }
      }

      // Función para cambiar imagen del carrusel de oficina
      function changeOfficeImage(officeId, imageIndex) {
        const images = document.querySelectorAll(`#${officeId} .office-image`);
        const indicators = document.querySelectorAll(`#${officeId} .image-indicator`);
        
        images.forEach(img => img.classList.add('hidden'));
        indicators.forEach(ind => ind.classList.remove('bg-white', 'bg-opacity-100'));
        indicators.forEach(ind => ind.classList.add('bg-white', 'bg-opacity-50'));
        
        if (images[imageIndex]) {
          images[imageIndex].classList.remove('hidden');
        }
        if (indicators[imageIndex]) {
          indicators[imageIndex].classList.remove('bg-opacity-50');
          indicators[imageIndex].classList.add('bg-opacity-100');
        }
      }

      // Inicialización cuando el DOM esté listo
      document.addEventListener('DOMContentLoaded', function() {
        // Mostrar el primer slide
        showSlide(0);
        showOfficeSlide(0);
        showReviewSlide(0);
        
        // Auto-play del carrusel principal cada 5 segundos
        setInterval(nextSlide, 5000);
        
        // Event listeners para el menú móvil (sidemenu)
        const menuButton = document.getElementById('menu-button');
        if (menuButton) {
          menuButton.addEventListener('click', toggleMobileMenu);
        }
        const menuButtonInside = document.getElementById('menu-button-inside');
        if (menuButtonInside) {
          menuButtonInside.addEventListener('click', toggleMobileMenu);
        }
        const backdrop = document.getElementById('mobile-backdrop');
        if (backdrop) {
          backdrop.addEventListener('click', closeMobileMenu);
        }
        // Cerrar con tecla ESC
        document.addEventListener('keydown', (e) => {
          if (e.key === 'Escape') closeMobileMenu();
        });

        // Event listeners para búsqueda móvil
        const searchButton = document.getElementById('search-button');
        if (searchButton) {
          searchButton.addEventListener('click', function() {
            const searchBar = document.getElementById('search-bar');
            if (searchBar) {
              searchBar.classList.toggle('hidden');
            }
          });
        }

        // Event listeners para dropdowns del header
        document.querySelectorAll('.dropdown-group button').forEach(button => {
          button.addEventListener('click', function(e) {
            e.preventDefault();
            const dropdownGroup = this.closest('.dropdown-group');
            const dropdownName = dropdownGroup.getAttribute('data-dropdown');
            toggleDropdown(dropdownName);
          });
        });

        // Event listeners para acordeones móviles
        const mobileSeguroBtn = document.getElementById('mobile-seguros-btn');
        if (mobileSeguroBtn) {
          mobileSeguroBtn.addEventListener('click', () => toggleMobileAccordion('seguros'));
        }

        const mobileSeguridadBtn = document.getElementById('mobile-seguridad-btn');
        if (mobileSeguridadBtn) {
          mobileSeguridadBtn.addEventListener('click', () => toggleMobileAccordion('seguridad'));
        }

        const mobileEmpresasBtn = document.getElementById('mobile-empresas-btn');
        if (mobileEmpresasBtn) {
          mobileEmpresasBtn.addEventListener('click', () => toggleMobileAccordion('empresas'));
        }
        
        // Cerrar dropdowns al hacer clic fuera
        document.addEventListener('click', function(event) {
          const isDropdownClick = event.target.closest('.dropdown-group');
          const isMobileMenuClick = event.target.closest('#mobile-menu-panel') || event.target.closest('#menu-button');
          
          if (!isDropdownClick) {
            document.querySelectorAll('.dropdown-menu').forEach(menu => {
              menu.classList.add('opacity-0', 'invisible');
              menu.classList.remove('opacity-100', 'visible');
            });
            document.querySelectorAll('.dropdown-arrow').forEach(arrow => {
              arrow.style.transform = 'rotate(0deg)';
            });
          }

          if (!isMobileMenuClick) {
            const overlay = document.getElementById('mobile-overlay');
            if (overlay && !overlay.classList.contains('hidden')) {
              closeMobileMenu();
            }
          }
        });
      });

      // Hacer las funciones globales para que puedan ser llamadas desde los elementos HTML
      window.showSlide = showSlide;
      window.nextSlide = nextSlide;
      window.prevSlide = prevSlide;
      window.showOfficeSlide = showOfficeSlide;
      window.nextOfficeSlide = nextOfficeSlide;
      window.prevOfficeSlide = prevOfficeSlide;
      window.showReviewSlide = showReviewSlide;
      window.nextReviewSlide = nextReviewSlide;
      window.prevReviewSlide = prevReviewSlide;
      window.toggleMobileMenu = toggleMobileMenu;
      window.openMobileMenu = openMobileMenu;
      window.closeMobileMenu = closeMobileMenu;
      window.toggleDropdown = toggleDropdown;
      window.toggleMobileAccordion = toggleMobileAccordion;
      window.toggleAccordion = toggleAccordion;
      window.toggleSearch = toggleSearch;
      window.changeOfficeImage = changeOfficeImage;
    </script>
  </body>
</html>